<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Coach - CoachPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navbar -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-dumbbell text-3xl text-purple-600 mr-3"></i>
                    <span class="text-2xl font-bold text-gray-800">CoachPro</span>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="coachprofile.html" class="text-gray-700 hover:text-purple-600 font-medium transition duration-300">
                        <i class="fas fa-user-circle mr-1"></i>Mon Profil
                    </a>
                    <span class="text-gray-700 font-medium">Bonjour, <span id="coachName">Coach</span></span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300">
                        <i class="fas fa-sign-out-alt mr-2"></i>Déconnexion
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-semibold">En Attente</p>
                        <p class="text-3xl font-bold text-yellow-600" id="pendingRequests">0</p>
                    </div>
                    <div class="bg-yellow-100 rounded-full p-3">
                        <i class="fas fa-clock text-2xl text-yellow-600"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-semibold">Aujourd'hui</p>
                        <p class="text-3xl font-bold text-green-600" id="todaySessions">0</p>
                    </div>
                    <div class="bg-green-100 rounded-full p-3">
                        <i class="fas fa-calendar-day text-2xl text-green-600"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-semibold">Demain</p>
                        <p class="text-3xl font-bold text-blue-600" id="tomorrowSessions">0</p>
                    </div>
                    <div class="bg-blue-100 rounded-full p-3">
                        <i class="fas fa-calendar-plus text-2xl text-blue-600"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-semibold">Note Moyenne</p>
                        <p class="text-3xl font-bold text-purple-600" id="averageRating">0.0</p>
                    </div>
                    <div class="bg-purple-100 rounded-full p-3">
                        <i class="fas fa-star text-2xl text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Next Session Alert -->
        <div id="nextSessionAlert" class="bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-xl shadow-lg p-6 mb-8 hidden">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-xl font-bold mb-2">
                        <i class="fas fa-bell mr-2"></i>Prochaine Séance
                    </h3>
                    <p class="text-lg" id="nextSessionInfo">Aucune séance prévue</p>
                </div>
                <i class="fas fa-running text-5xl opacity-50"></i>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Booking Requests -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Pending Requests -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-inbox text-yellow-600 mr-2"></i>Demandes en Attente
                    </h2>
                    <div id="pendingRequestsList" class="space-y-4">
                        <!-- Pending requests will be loaded here -->
                    </div>
                </div>

                <!-- Accepted Sessions -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>Séances Validées
                    </h2>
                    <div id="acceptedSessionsList" class="space-y-4 max-h-96 overflow-y-auto">
                        <!-- Accepted sessions will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Availability Management -->
            <div class="space-y-6">
                <!-- Add Availability -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-calendar-plus text-purple-600 mr-2"></i>Ajouter Disponibilité
                    </h2>
                    <form id="availabilityForm">
                        <div class="mb-4">
                            <label for="availDate" class="block text-gray-700 font-semibold mb-2">Date</label>
                            <input type="date" id="availDate" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                        </div>
                        <div class="mb-4">
                            <label for="startTime" class="block text-gray-700 font-semibold mb-2">Heure début</label>
                            <input type="time" id="startTime" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                        </div>
                        <div class="mb-4">
                            <label for="endTime" class="block text-gray-700 font-semibold mb-2">Heure fin</label>
                            <input type="time" id="endTime" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-2 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition duration-300">
                            <i class="fas fa-plus mr-2"></i>Ajouter
                        </button>
                    </form>
                </div>

                <!-- My Availabilities -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-clock text-purple-600 mr-2"></i>Mes Disponibilités
                    </h2>
                    <div id="availabilitiesList" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Availabilities will be loaded here -->
                    </div>
                </div>

                <!-- Reviews -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-star text-yellow-500 mr-2"></i>Avis Reçus
                    </h2>
                    <div id="reviewsList" class="space-y-3 max-h-64 overflow-y-auto">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data - Replace with actual API calls
        let bookingRequests = [
            { id: 1, sportif: "Youssef Amrani", date: "2025-12-20", time: "14:00-15:00", status: "pending", sportif_id: 1 },
            { id: 2, sportif: "Amina Benkirane", date: "2025-12-21", time: "10:00-11:00", status: "pending", sportif_id: 2 }
        ];

        let acceptedSessions = [
            { id: 3, sportif: "Omar Tazi", date: "2025-12-18", time: "09:00-10:00", status: "accepted" },
            { id: 4, sportif: "Leila Mahjoub", date: "2025-12-19", time: "15:00-16:00", status: "accepted" }
        ];

        let availabilities = [
            { id: 1, date: "2025-12-20", start: "09:00", end: "10:00", status: "available" },
            { id: 2, date: "2025-12-20", start: "14:00", end: "15:00", status: "booked" },
            { id: 3, date: "2025-12-21", start: "10:00", end: "11:00", status: "available" }
        ];

        let reviews = [
            { id: 1, sportif: "Hassan Alami", rating: 5, comment: "Excellent coach! Très professionnel.", date: "2025-12-10" },
            { id: 2, sportif: "Sara Idrissi", rating: 4, comment: "Bon entraînement, je recommande.", date: "2025-12-08" }
        ];

        // Load stats
        function loadStats() {
            document.getElementById('pendingRequests').textContent = bookingRequests.filter(b => b.status === 'pending').length;
            
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date(Date.now() + 86400000).toISOString().split('T')[0];
            
            document.getElementById('todaySessions').textContent = acceptedSessions.filter(s => s.date === today).length;
            document.getElementById('tomorrowSessions').textContent = acceptedSessions.filter(s => s.date === tomorrow).length;
            
            const avgRating = reviews.length > 0 ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1) : '0.0';
            document.getElementById('averageRating').textContent = avgRating;

            // Show next session
            const nextSession = acceptedSessions.sort((a, b) => new Date(a.date) - new Date(b.date))[0];
            if (nextSession) {
                document.getElementById('nextSessionAlert').classList.remove('hidden');
                document.getElementById('nextSessionInfo').textContent = `${nextSession.sportif} - ${nextSession.date} à ${nextSession.time}`;
            }
        }

        // Load pending requests
        function loadPendingRequests() {
            const list = document.getElementById('pendingRequestsList');
            
            if (bookingRequests.filter(b => b.status === 'pending').length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">Aucune demande en attente</p>';
                return;
            }

            list.innerHTML = bookingRequests.filter(b => b.status === 'pending').map(request => `
                <div class="border-2 border-yellow-200 bg-yellow-50 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-bold text-gray-800 text-lg">
                                <i class="fas fa-user text-purple-600 mr-2"></i>${request.sportif}
                            </h4>
                            <p class="text-sm text-gray-600 mt-1">
                                <i class="fas fa-calendar mr-1"></i>${request.date}
                            </p>
                            <p class="text-sm text-gray-600">
                                <i class="fas fa-clock mr-1"></i>${request.time}
                            </p>
                        </div>
                        <span class="px-3 py-1 bg-yellow-200 text-yellow-800 rounded-full text-xs font-semibold">
                            <i class="fas fa-hourglass-half mr-1"></i>En attente
                        </span>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="acceptBooking(${request.id})" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 rounded-lg transition duration-300">
                            <i class="fas fa-check mr-1"></i>Accepter
                        </button>
                        <button onclick="rejectBooking(${request.id})" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg transition duration-300">
                            <i class="fas fa-times mr-1"></i>Refuser
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Load accepted sessions
        function loadAcceptedSessions() {
            const list = document.getElementById('acceptedSessionsList');
            
            if (acceptedSessions.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">Aucune séance validée</p>';
                return;
            }

            list.innerHTML = acceptedSessions.map(session => `
                <div class="border-2 border-green-200 bg-green-50 rounded-lg p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-bold text-gray-800">
                                <i class="fas fa-user text-purple-600 mr-2"></i>${session.sportif}
                            </h4>
                            <p class="text-sm text-gray-600 mt-1">
                                <i class="fas fa-calendar mr-1"></i>${session.date}
                            </p>
                            <p class="text-sm text-gray-600">
                                <i class="fas fa-clock mr-1"></i>${session.time}
                            </p>
                        </div>
                        <span class="px-3 py-1 bg-green-200 text-green-800 rounded-full text-xs font-semibold">
                            <i class="fas fa-check-circle mr-1"></i>Validée
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // Load availabilities
        function loadAvailabilities() {
            const list = document.getElementById('availabilitiesList');
            
            if (availabilities.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">Aucune disponibilité</p>';
                return;
            }

            const statusColors = {
                available: 'bg-green-100 text-green-800',
                booked: 'bg-blue-100 text-blue-800',
                cancelled: 'bg-red-100 text-red-800'
            };

            const statusText = {
                available: 'Disponible',
                booked: 'Réservée',
                cancelled: 'Annulée'
            };

            list.innerHTML = availabilities.map(avail => `
                <div class="border-2 border-gray-200 rounded-lg p-3">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-sm">
                            <p class="font-semibold text-gray-800">${avail.date}</p>
                            <p class="text-gray-600">${avail.start} - ${avail.end}</p>
                        </div>
                        <span class="px-2 py-1 rounded text-xs font-semibold ${statusColors[avail.status]}">${statusText[avail.status]}</span>
                    </div>
                    ${avail.status === 'available' ? `
                        <button onclick="deleteAvailability(${avail.id})" class="w-full bg-red-500 hover:bg-red-600 text-white text-xs py-1 rounded transition duration-300">
                            <i class="fas fa-trash mr-1"></i>Supprimer
                        </button>
                    ` : ''}
                </div>
            `).join('');
        }

        // Load reviews
        function loadReviews() {
            const list = document.getElementById('reviewsList');
            
            if (reviews.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">Aucun avis</p>';
                return;
            }

            list.innerHTML = reviews.map(review => `
                <div class="border-2 border-gray-200 rounded-lg p-3">
                    <div class="flex justify-between items-start mb-2">
                        <p class="font-semibold text-gray-800 text-sm">${review.sportif}</p>
                        <div class="flex items-center">
                            ${Array(review.rating).fill().map(() => '<i class="fas fa-star text-yellow-500 text-xs"></i>').join('')}
                            ${Array(5 - review.rating).fill().map(() => '<i class="fas fa-star text-gray-300 text-xs"></i>').join('')}
                        </div>
                    </div>
                    <p class="text-gray-600 text-xs mb-1">${review.comment}</p>
                    <p class="text-gray-400 text-xs">${review.date}</p>
                </div>
            `).join('');
        }

        // Add availability
        document.getElementById('availabilityForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('availDate').value;
            const start = document.getElementById('startTime').value;
            const end = document.getElementById('endTime').value;

            // Validate time
            if (start >= end) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'L\'heure de fin doit être après l\'heure de début',
                    confirmButtonColor: '#7c3aed'
                });
                return;
            }

            // Check if date is in the past
            const today = new Date().toISOString().split('T')[0];
            if (date < today) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'La date ne peut pas être dans le passé',
                    confirmButtonColor: '#7c3aed'
                });
                return;
            }

            // Add availability (Replace with API call)
            availabilities.push({
                id: availabilities.length + 1,
                date: date,
                start: start,
                end: end,
                status: 'available'
            });

            Swal.fire({
                icon: 'success',
                title: 'Succès!',
                text: 'Disponibilité ajoutée',
                confirmButtonColor: '#7c3aed'
            });

            this.reset();
            loadAvailabilities();
        });

        // Accept booking
        function acceptBooking(bookingId) {
            Swal.fire({
                title: 'Accepter cette réservation?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#10b981',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Oui, accepter',
                cancelButtonText: 'Annuler'
            }).then((result) => {
                if (result.isConfirmed) {
                    const index = bookingRequests.findIndex(b => b.id === bookingId);
                    if (index > -1) {
                        const booking = bookingRequests[index];
                        booking.status = 'accepted';
                        acceptedSessions.push(booking);
                        bookingRequests.splice(index, 1);

                        // Update availability status
                        const availIndex = availabilities.findIndex(a => 
                            a.date === booking.date && 
                            `${a.start}-${a.end}` === booking.time
                        );
                        if (availIndex > -1) {
                            availabilities[availIndex].status = 'booked';
                        }

                        Swal.fire({
                            icon: 'success',
                            title: 'Acceptée!',
                            text: 'La réservation a été acceptée',
                            confirmButtonColor: '#7c3aed'
                        });

                        loadPendingRequests();
                        loadAcceptedSessions();
                        loadAvailabilities();
                        loadStats();
                    }
                }
            });
        }

        // Reject booking
        function rejectBooking(bookingId) {
            Swal.fire({
                title: 'Refuser cette réservation?',
                text: 'Le sportif sera notifié',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Oui, refuser',
                cancelButtonText: 'Annuler'
            }).then((result) => {
                if (result.isConfirmed) {
                    const index = bookingRequests.findIndex(b => b.id === bookingId);
                    if (index > -1) {
                        bookingRequests[index].status = 'rejected';
                        bookingRequests.splice(index, 1);

                        Swal.fire({
                            icon: 'success',
                            title: 'Refusée!',
                            text: 'La réservation a été refusée',
                            confirmButtonColor: '#7c3aed'
                        });

                        loadPendingRequests();
                        loadStats();
                    }
                }
            });
        }

        // Delete availability
        function deleteAvailability(availId) {
            Swal.fire({
                title: 'Supprimer cette disponibilité?',
                text: 'Cette action est irréversible',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Oui, supprimer',
                cancelButtonText: 'Annuler'
            }).then((result) => {
                if (result.isConfirmed) {
                    const index = availabilities.findIndex(a => a.id === availId);
                    if (index > -1) {
                        availabilities.splice(index, 1);

                        Swal.fire({
                            icon: 'success',
                            title: 'Supprimée!',
                            text: 'La disponibilité a été supprimée',
                            confirmButtonColor: '#7c3aed'
                        });

                        loadAvailabilities();
                    }
                }
            });
        }

        // Set minimum date for availability form
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('availDate').setAttribute('min', today);

        // Logout
        function logout() {
            Swal.fire({
                title: 'Déconnexion',
                text: "Voulez-vous vous déconnecter?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#7c3aed',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Oui',
                cancelButtonText: 'Non'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = 'login.html';
                }
            });
        }

        // Initialize
        loadStats();
        loadPendingRequests();
        loadAcceptedSessions();
        loadAvailabilities();
        loadReviews();
    </script>
</body>
</html>